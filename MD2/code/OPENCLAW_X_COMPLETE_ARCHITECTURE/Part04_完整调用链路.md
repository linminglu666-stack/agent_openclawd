# OpenClaw-X 完整架构整合文档

## 文档说明

本文档整合了事无巨细的设计思路、流程图、实现细节、模块间数据接口与通信协议。

---


# 第四部分：完整调用链路

## 4.1 用户请求 → 最终响应 完整流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      完整调用链路                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  User Request                                                            │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────┐                                                    │
│  │   BFF / API     │  ← JWT验证 + RBAC检查                              │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────┐                                                    │
│  │ Central Brain   │  ← 任务分类 + 风险评估 + 路由决策                  │
│  │                 │                                                    │
│  │ 1. 解析请求     │                                                    │
│  │ 2. 评估风险     │                                                    │
│  │ 3. 选择Agent    │                                                    │
│  │ 4. 派发任务     │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────┐                                                    │
│  │   Agent Pool    │  ← 获取空闲Agent                                   │
│  │                 │                                                    │
│  │ 1. 技能匹配     │                                                    │
│  │ 2. 负载均衡     │                                                    │
│  │ 3. 资源分配     │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────────────────────────────────────────────────┐        │
│  │                      Agent Execution                         │        │
│  │                                                              │        │
│  │  ┌─────────────────┐                                        │        │
│  │  │ StrategyRouter  │  ← 问题分类 → 策略选择                 │        │
│  │  └────────┬────────┘                                        │        │
│  │           │                                                  │        │
│  │           ▼                                                  │        │
│  │  ┌─────────────────┐                                        │        │
│  │  │  CoTInjector    │  ← Prompt增强                          │        │
│  │  └────────┬────────┘                                        │        │
│  │           │                                                  │        │
│  │           ▼                                                  │        │
│  │  ┌─────────────────────────────────────────────────────┐   │        │
│  │  │              Reasoning Engines                       │   │        │
│  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐               │   │        │
│  │  │  │SelfCons │ │   ToT   │ │Reflexion│  ...          │   │        │
│  │  │  └─────────┘ └─────────┘ └─────────┘               │   │        │
│  │  └──────────────────────┬──────────────────────────────┘   │        │
│  │                         │                                   │        │
│  │                         ▼                                   │        │
│  │  ┌─────────────────┐                                        │        │
│  │  │   TruthGate     │  ← 结果验证                            │        │
│  │  └────────┬────────┘                                        │        │
│  │           │                                                  │        │
│  └───────────┼─────────────────────────────────────────────────┘        │
│              │                                                           │
│              ▼                                                           │
│  ┌─────────────────┐                                                    │
│  │  Memory Hub     │  ← 记忆存储 + 证据链记录                           │
│  │                 │                                                    │
│  │ 1. 存储结果     │                                                    │
│  │ 2. 更新证据链   │                                                    │
│  │ 3. 触发学习     │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────┐                                                    │
│  │  Growth Loop    │  ← 空闲学习 + 能力沉淀                             │
│  │                 │                                                    │
│  │ 1. 检测空闲     │                                                    │
│  │ 2. 触发学习     │                                                    │
│  │ 3. 注册技能     │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│      Final Response                                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---
