#!/bin/bash
# GitËá™Âä®Êé®ÈÄÅËÑöÊú¨
# Âª∫ËÆÆÈÖçÁΩÆSSHÂØÜÈí•Êàñ‰ΩøÁî®GitHub TokenËøõË°åËÆ§ËØÅ

WORKSPACE="/home/maco_six/.openclaw/workspace"
REPO_URL="https://github.com/linminglu666-stack/agent_openclawd.git"
LOG_FILE="$WORKSPACE/.git_push.log"

echo "================================================================================"
echo "üöÄ GitËá™Âä®Êé®ÈÄÅËÑöÊú¨"
echo "================================================================================"
echo "Êé®ÈÄÅÊó∂Èó¥: $(date '+%Y-%m-%d %H:%M:%S')"
echo "‰ªìÂ∫ì: $REPO_URL"
echo "================================================================================"

cd "$WORKSPACE" || exit 1

# Ê£ÄÊü•gitÁä∂ÊÄÅ
echo "üìä Ê£ÄÊü•GitÁä∂ÊÄÅ..."
git status --short

# Ê∑ªÂä†ÊâÄÊúâÊõ¥Êîπ
echo ""
echo "üì¶ Ê∑ªÂä†Êõ¥Êîπ..."
git add -A

# Ê£ÄÊü•ÊòØÂê¶ÊúâÊõ¥ÊîπË¶ÅÊèê‰∫§
if git diff --cached --quiet; then
    echo "‚úÖ Ê≤°ÊúâË¶ÅÊèê‰∫§ÁöÑÊõ¥Êîπ"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Ê≤°ÊúâÊõ¥Êîπ" >> "$LOG_FILE"
    exit 0
fi

# Êèê‰∫§Êõ¥Êîπ
echo ""
echo "üíæ Êèê‰∫§Êõ¥Êîπ..."
git commit -m "auto: Ëá™Âä®Êèê‰∫§Êõ¥Êñ∞ $(date '+%Y-%m-%d %H:%M:%S')

- ËÆ≠ÁªÉËøõÂ∫¶Êõ¥Êñ∞
- ÁõëÊéßÊó•ÂøóÊõ¥Êñ∞
- ËÆ∞ÂøÜÊï¥ÂêàÁªìÊûú"

# Êé®ÈÄÅÂà∞ËøúÁ®ã
echo ""
echo "üì§ Êé®ÈÄÅÂà∞ËøúÁ®ã‰ªìÂ∫ì..."
if git push origin master; then
    echo "‚úÖ Êé®ÈÄÅÊàêÂäü!"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Êé®ÈÄÅÊàêÂäü" >> "$LOG_FILE"
else
    echo "‚ùå Êé®ÈÄÅÂ§±Ë¥•"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Êé®ÈÄÅÂ§±Ë¥•" >> "$LOG_FILE"
    exit 1
fi

echo ""
echo "================================================================================"
echo "‚úÖ ÂÆåÊàê"
echo "================================================================================"
